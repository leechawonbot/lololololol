<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìœ„ë°”ìœ„ë³´ ì—°ìŠ¹ ì±Œë¦°ì§€</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ ë° ì¶”ê°€ ìŠ¤íƒ€ì¼ */
        body {
            background-color: #a0c4ff;
            font-family: 'Pretendard', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #1a3a6e;
            flex-direction: column; /* ì„¸ë¡œ ë°°ì¹˜ í—ˆìš© */
            padding: 20px;
        }

        .main-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .game-container, .leaderboard-container {
            text-align: center;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 100%;
        }

        h1 { font-size: 2em; margin-bottom: 10px; }
        h2 { font-size: 1.5em; margin-bottom: 15px; color: #4a7ac2; }

        .streak-box {
            background-color: #e0eaff;
            padding: 10px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: bold;
            font-size: 1.2em;
        }

        .streak-count { color: #ff4757; font-size: 1.5em; }

        .choices button {
            font-size: 3.5rem;
            margin: 5px;
            padding: 10px;
            border: 3px solid #699eff;
            border-radius: 50%;
            background-color: #fff;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        .choices button:hover { transform: scale(1.1); background-color: #e0eaff; }

        .result-display {
             display: flex;
             justify-content: center;
             gap: 20px;
             margin-top: 20px;
        }
        .result-display span { font-size: 2.5rem; display: block; }
        .result { margin-top: 20px; font-size: 1.5em; font-weight: bold; height: 40px; }

        /* ë¦¬ë”ë³´ë“œ ìŠ¤íƒ€ì¼ */
        .input-group {
            margin-top: 20px;
            display: flex;
            gap: 5px;
            justify-content: center;
        }
        input {
            padding: 10px;
            border: 2px solid #699eff;
            border-radius: 8px;
            width: 60%;
        }
        .btn-save {
            padding: 10px 15px;
            background-color: #699eff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-save:hover { background-color: #4a7ac2; }
        .btn-save:disabled { background-color: #ccc; cursor: not-allowed; }

        ul { list-style: none; padding: 0; text-align: left; }
        li {
            padding: 8px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }
        li:first-child { font-weight: bold; color: #ff4757; }
    </style>
</head>
<body>

<div class="main-container">
    <div class="game-container">
        <h1>ê°€ìœ„ë°”ìœ„ë³´ ì±Œë¦°ì§€</h1>
        
        <div class="streak-box">
            í˜„ì¬ ì—°ìŠ¹: <span id="current-streak" class="streak-count">0</span>ìŠ¹
        </div>

        <div class="choices">
            <button onclick="playGame('rock')">âœŠ</button>
            <button onclick="playGame('paper')">âœ‹</button>
            <button onclick="playGame('scissors')">âœŒï¸</button>
        </div>

        <div class="result-display">
            <div><p>ë‚˜</p><span id="player-choice-emoji">â”</span></div>
            <div><p>ì»´í“¨í„°</p><span id="computer-choice-emoji">â”</span></div>
        </div>
        
        <div id="result-text" class="result">ë„ì „ì„ ì‹œì‘í•˜ì„¸ìš”!</div>

        <div class="input-group">
            <input type="text" id="player-name" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" maxlength="10">
            <button class="btn-save" onclick="saveRecord()" id="save-btn">ê¸°ë¡ ì €ì¥</button>
        </div>
    </div>

    <div class="leaderboard-container">
        <h2>ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹ (TOP 10)</h2>
        <ul id="leaderboard-list">
            <li>ë¡œë”© ì¤‘...</li>
        </ul>
    </div>
</div>

<script>
    // ==========================================
    // 1. Supabase ì„¤ì • (ì´ ë¶€ë¶„ì„ ê¼­ ì±„ì›Œì£¼ì„¸ìš”!)
    // ==========================================
    const SUPABASE_URL = 'https://ajhxgmzobahnobddjbcz.supabase.co'; // ì˜ˆ: https://xyz.supabase.co
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFqaHhnbXpvYmFobm9iZGRqYmN6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2MzAxNjUsImV4cCI6MjA3OTIwNjE2NX0.wqPf2ScwTOW_E8dcVWz7uKC1upoF6b99OD1Q5Or8eOA'; // Settings > API > anon public key

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // ==========================================
    // 2. ê²Œì„ ë¡œì§
    // ==========================================
    let streak = 0;
    const choices = ['rock', 'paper', 'scissors'];
    const emojis = { rock: 'âœŠ', paper: 'âœ‹', scissors: 'âœŒï¸' };
    
    const resultText = document.getElementById('result-text');
    const streakDisplay = document.getElementById('current-streak');
    const pEmoji = document.getElementById('player-choice-emoji');
    const cEmoji = document.getElementById('computer-choice-emoji');

    function playGame(player) {
        const computer = choices[Math.floor(Math.random() * choices.length)];
        pEmoji.textContent = emojis[player];
        cEmoji.textContent = emojis[computer];

        if (player === computer) {
            resultText.innerHTML = "ë¹„ê²¼ìŠµë‹ˆë‹¤! (ì—°ìŠ¹ ìœ ì§€)";
            resultText.style.color = "#555";
        } else if (
            (player === 'rock' && computer === 'scissors') ||
            (player === 'paper' && computer === 'rock') ||
            (player === 'scissors' && computer === 'paper')
        ) {
            streak++;
            resultText.innerHTML = "ì´ê²¼ìŠµë‹ˆë‹¤! ğŸ”¥";
            resultText.style.color = "#2ecc71";
        } else {
            streak = 0; // ì§€ë©´ ì—°ìŠ¹ ì´ˆê¸°í™”
            resultText.innerHTML = "ì¡ŒìŠµë‹ˆë‹¤... ì—°ìŠ¹ ë ğŸ˜¢";
            resultText.style.color = "#e74c3c";
        }
        streakDisplay.textContent = streak;
    }

    // ==========================================
    // 3. ë¦¬ë”ë³´ë“œ ê¸°ëŠ¥ (Supabase)
    // ==========================================
    
    // ê¸°ë¡ ì €ì¥í•˜ê¸°
    async function saveRecord() {
        const name = document.getElementById('player-name').value;
        if (!name) {
            alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
            return;
        }
        if (streak === 0) {
            alert("0ìŠ¹ì€ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì´ê²¨ë³´ì„¸ìš”!");
            return;
        }

        const btn = document.getElementById('save-btn');
        btn.disabled = true;
        btn.textContent = "ì €ì¥ ì¤‘...";

        try {
            // ë°ì´í„° ì‚½ì…
            const { error } = await supabase
                .from('leaderboard')
                .insert([{ player_name: name, streak_count: streak }]);

            if (error) throw error;

            alert("ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
            fetchLeaderboard(); // ë¦¬ë”ë³´ë“œ ìƒˆë¡œê³ ì¹¨
        } catch (err) {
            console.error('Error:', err);
            alert("ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        } finally {
            btn.disabled = false;
            btn.textContent = "ê¸°ë¡ ì €ì¥";
        }
    }

    // ë¦¬ë”ë³´ë“œ ë¶ˆëŸ¬ì˜¤ê¸°
    async function fetchLeaderboard() {
        const list = document.getElementById('leaderboard-list');
        
        try {
            // streak_count ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ìƒìœ„ 10ê°œ ê°€ì ¸ì˜¤ê¸°
            const { data, error } = await supabase
                .from('leaderboard')
                .select('*')
                .order('streak_count', { ascending: false })
                .limit(10);

            if (error) throw error;

            // HTML ê·¸ë¦¬ê¸°
            list.innerHTML = '';
            data.forEach((item, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>${index + 1}ìœ„. ${item.player_name}</span>
                    <strong>${item.streak_count}ì—°ìŠ¹</strong>
                `;
                list.appendChild(li);
            });
        } catch (err) {
            console.error('Error:', err);
            list.innerHTML = '<li>ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨</li>';
        }
    }

    // í˜ì´ì§€ ë¡œë“œì‹œ ë¦¬ë”ë³´ë“œ ë¶ˆëŸ¬ì˜¤ê¸°
    window.onload = fetchLeaderboard;

</script>

</body>
</html>

